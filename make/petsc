# ALL: ex1
# CFLAGS     =
# FFLAGS     =
# CPPFLAGS   =
# FPPFLAGS   =
CLEANFILES = ex1

include ${PETSC_DIR}/lib/petsc/conf/variables
# include ${PETSC_DIR}/lib/petsc/conf/rules

CXXFLAGS += ${CXX_FLAGS}	# add petsc flags
CXXFLAGS += ${CCPPFLAGS}	# add petsc flags
LDFLAGS += ${PETSC_LIB}		# add petsc flags

PCC_LINKER_FLAGS_BUG := -Wl,-no_compact_unwind ## crashes original math tests, removed
PCC_LINKER_FLAGS_FIX := $(filter-out $(PCC_LINKER_FLAGS_BUG),$(PCC_LINKER_FLAGS))

debug0:
	echo ${PCC_LINKER_FLAGS_FIX}

# debug: Why Did File foo Get Built?
# OLD_SHELL := $(SHELL)
# SHELL = $(warning [$@ ($^) ($?)])$(OLD_SHELL)

STAN_PETSC_HEADERS := $(shell find stan -name *petsc*.hpp)
# $(STAN_PETSC_HEADERS) : ${PETSC_LIB}

%_petsc.o: %_petsc.c
	${COMPILE.cpp} $(OUTPUT_OPTION) -c $<
%_petsc: %_petsc.o
	$(LINK.cpp) ${PCC_LINKER_FLAGS_FIX} -o $@ $<
	${RM} $<



